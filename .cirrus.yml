# $FreeBSD$

compute_engine_instance:
  # Image list available via
  # gcloud compute images list --project freebsd-org-cloud-dev --no-standard-images
  platform: freebsd
  image_project: freebsd-org-cloud-dev
  image: freebsd-13-1-release-amd64
  cpu: 8
  memory: 8G
  disk: 80

env:
  CIRRUS_CLONE_DEPTH: 1

task:
  name: OCI image build
  timeout_in: 120m
  install_script:
  - sh .cirrus-ci/pkg-install.sh qemu-nox11
  setup_script:
  - uname -a
  - gpart show
  - df -m
  - pkg --version
  build_script:
  - make -s -j$(sysctl -n hw.ncpu) buildworld
  - make -s -j$(sysctl -n hw.ncpu) buildkernel
  release_script:
  - cd release
  - make -s -DNOPORTS -DNOSRC KERNCONF=GENERIC WITH_CLOUDWARE=yes CLOUDWARE=OCI cloudware-release
  post_script:
  - df -m
  - du -m -s /usr/obj
